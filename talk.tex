\documentclass[aspectratio=169]{beamer}
\usetheme[logo]{hypro} % the template, use option "wwu" instead of "logo" to set the footer
\usepackage[useregional]{datetime2} % nice date typesetting
\usepackage{csquotes} % to quote stuff via \enquote{stuff}
\usepackage{xspace} % automated spacing after macros
\usepackage[normalem]{ulem} % allows to strikethrough text via \sout{text}
\usepackage{siunitx} % for nice units
\usetikzlibrary{calc,decorations.markings,arrows.meta,automata,backgrounds,positioning,intersections,shapes,decorations.pathreplacing,positioning,patterns}

\title{Optimizing reachability probabilities for a restricted class of Stochastic Hybrid Automata via Flowpipe-Construction}
\author[Stefan Schupp]{Carina Pilch, \textbf{Stefan Schupp}, Anne Remke}
\date{\DTMdisplaydate{2021}{7}{7}{-1}}

%################ Commands
\newcommand{\cb}[1]{\textcolor{blue100}{#1}\xspace}



\begin{document}

\begin{frame}[plain]
	\begin{centering}
		\vspace*{0.5cm}
		\begin{beamercolorbox}[sep=8pt,center]{title}
			\usebeamerfont{title}\inserttitle\par%
			\ifx\insertsubtitle\@empty%
			\else%
			\vskip0.25em%
			{\usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}\insertsubtitle\par}%
			\fi%
		\end{beamercolorbox}%
		\vskip1em\par
		\begin{beamercolorbox}[sep=8pt,center]{author}
			\usebeamerfont{author}\insertauthor
		\end{beamercolorbox}
		\begin{beamercolorbox}[sep=8pt,center]{institute}
			
			\includegraphics[height=1cm]{pics/TU_logo.png}\hspace{.5cm}\includegraphics[height=1cm]{pics/wwu.png}
			
			\usebeamerfont{institute}\insertinstitute
		\end{beamercolorbox}
		\begin{beamercolorbox}[sep=8pt,center]{date}
			\usebeamerfont{date}\insertdate
		\end{beamercolorbox}%\vskip0.5em
		\vfill
		\if@dfg
		\vspace*{1cm}
		\tiny
		This work is part of the project HyPro
		\if@unravel
		and the Research Training Group 2236 UnRAVeL
		\fi
		\\
		\href{http://ths.rwth-aachen.de/research/hypro/}{\includegraphics[width=.15\paperwidth]{pics/hypro_logo.png}}
		\if@unravel
		\qquad
		\href{https://moves.rwth-aachen.de/research/projects/unravel/}{\includegraphics[width=.15\paperwidth]{pics/rwth_unravel_bild_rgb.png}}\\
		\else
		\\
		\fi
		which
		\if@unravel
		are
		\else
		is
		\fi
		funded by the German Research Council (DFG).
		\else
		\if@unravel
		\tiny
		This work is part of the  Research Training Group 2236 UnRAVeL\\
		\href{https://moves.rwth-aachen.de/research/projects/unravel/}{\includegraphics[width=.15\paperwidth]{pics/rwth_unravel_bild_rgb.png}}\\
		which is funded by the German Research Council (DFG).
		\else
		\vspace*{1.6cm}
		\fi
		\fi

	\end{centering}
	% adjust page count
	\addtocounter{framenumber}{-1}
	%\vfill
\end{frame}

%########################################################

\begin{frame}{The problem in a nutshell}
  \enquote{\alert<2>{Optimizing \alert<1>{reachability probabilities}} for a \alert<5>{restricted class of \alert<4>{Stochastic \alert<3>{Hybrid Automata}}} via \alert<6>{Flowpipe-Construction}}

  \bigskip

  \only<3>{Hybrid automata: a model for \emph{hybrid systems}

  \medskip

  \cb{\faArrowRight} mixed discrete-continuous behavior
  }%
  \only<4>{Stochastic hybrid automata: a model for \emph{stochastic} hybrid systems

  \medskip

  \cb{\faArrowRight} add stochasticity
  \begin{itemize}
    \item continuous behavior: e.g., stochastic differential equations
    \item discrete behavior: e.g., stochastic jumps
  \end{itemize}
  }%
  \only<5>{Stochastic hybrid automata: a model for \emph{stochastic} hybrid systems

  \medskip

  \cb{Here:}
  \begin{itemize}
    \item \sout{continuous behavior: e.g., stochastic differential equations}
    \item discrete behavior: \cb{urgent} jumps and \cb{stochastic} jumps
    \item \cb{singular automata}
    \begin{itemize}
      \item constant derivatives
      \item predicates compare variables to constants (\enquote{axis-aligned})
    \end{itemize}
  \end{itemize}

  \bigskip

  \cb{Stochasticity:} continuous probability distributions
  }%
  \only<1>{\cb{Question:} What is the probability, given a set of initial states of reaching a set of \emph{goal states}?

  \bigskip

  Example: Stochastic jumps
  \begin{itemize}
    \item Are taken \enquote{randomly}
    \item The probability of taking this jump is given by a continuous densitiy function

    \cb{Intuition:} The probability of taking this jump increases with passage of time
  \end{itemize}

  %\medskip
  %Non-stochastic jumps
  %\begin{itemize}
  %  \item Guards only on continuous variables
  %  \item Potentially introduce non-determinism
  %\end{itemize}


  }%
  \only<2>{\cb{Question:} What is the \alert{maximal/minimal} probability, given a set of initial states of reaching a set of \emph{goal states}?

  \bigskip

  \cb{Observation:} There may be several ways (here: discrete non-determism) to reach a goal state


  \medskip
  Dealing with discrete choices
  \begin{itemize}
    \item Currently: Over-approximate (e.g., via state space discretization) probabilities for discrete non-determinism.
    \item Here: Exact probabilities (up to numerical integration)
  \end{itemize}

  }%
  \only<6>{\cb{Idea:} represent sets of reachable states by geometric shapes
  \begin{itemize}
    \item Usually over-approximative, here: \cb{exact}
    \item Different types of representations, here: \cb{convex polyhedra}
  \end{itemize}

  \vspace*{.7cm}

  \begin{minipage}{.5\linewidth}
    \scriptsize Time elapse

    \centering
    \input{pics/sa_time_elapse}
  \end{minipage}%
  \begin{minipage}{.5\linewidth}
    \scriptsize Jump successors (reset $x_0$)

    \centering
    \input{pics/sa_jump_successors}
  \end{minipage}%
  }%
\end{frame}

%########################################################

\begin{frame}{The approach}

  \begin{enumerate}
    \item Compute forwards reachability (flowpipe construction)
    \begin{itemize}
      \item Keep track of non-determistic choices $\rightarrow$ \emph{reach tree}
      \item Stochasticity via \emph{random clocks} (one per enabled jump)
    \end{itemize}
    \item Collect paths in the reach tree which lead to a goal state
    \item Compute \emph{optimal} probability of those paths with respect to different \emph{schedulers}
  \end{enumerate}

  \bigskip

  \centering
  \begin{reminder}{\scriptsize Info: Scheduler}{9cm}
    \tiny
    Intuition: a scheduler resolves discrete non-determinism

    Different types, relevant here:
    \begin{itemize}
      \item History-dependent (knows past decisions),
      \item Prophetic (knows all expiration times) vs. non-prophetic (does not know expiration times)
    \end{itemize}
  \end{reminder}
\end{frame}

%########################################################

\begin{frame}{Flowpipe construction \& reach tree}

  \begin{minipage}{.7\linewidth}
    \begin{itemize}
      \item Constant derivatives result in conic sets for time-successors
      \item Random variables as clocks
      \item Two types of jumps
      \begin{itemize}
        \item Urgent, guarded jumps:
          \begin{itemize}
            \item Leave location once an urgent discrete jump is enabled
            \item Jump time is deterministic
          \end{itemize}
          \item Stochastic jumps:
          \begin{itemize}
            \item Unguarded (always enabled, no restriction on stochasticity)
            \item Clocks track \enquote{enabling time}
            \item Clock disabled (globally) after taking stoch. jump
          \end{itemize}
      \end{itemize}
    \end{itemize}
  \end{minipage}%
  \begin{minipage}{.3\linewidth}
      \input{pics/random_clocks}
  \end{minipage}

  \begin{result}{In a nutshell}
    Non-determinism only over non-stochastic jumps
    \begin{itemize}
      \item Time point is fixed (urgent)
      \item In case several jumps are enabled: non-deterministic choice ($\rightarrow$ reach tree)
    \end{itemize}
  \end{result}

\end{frame}

%########################################################

\begin{frame}{Relevant paths}
After the analysis of the purely hybrid model (flowpipe construction) a \emph{reach tree} collects all state sets and discrete branchings
\begin{itemize}
  \item Nodes: represent passage of time, store flowpipe segments
  \item Parent-child relation: represents a discrete jump (stochastic or non-stochastic)
\end{itemize}

\bigskip

\cb{Approach}
\begin{itemize}
  \item Determine sets of reachable states that satisfy the goal-condition (intersection)
  \item A path in the reach tree to such a state set represents a sequence of discrete jumps (stochastic and non-stochastic)
  \begin{itemize}
    \item Stochastic jumps: The valuation of the random clock for this jump determines the probability to reach a goal state
    \item Non-stochastic jumps: Non-determinism needs to be resolved by a scheduler
  \end{itemize}
\end{itemize}





\end{frame}

%########################################################

\begin{frame}{Projection on random clocks}

  After the analysis, the reach tree contains sets of reachable states which contain
  \begin{itemize}
    \item Reachable valuations for continuous variables
    \item Reachable valuations for random clocks
  \end{itemize}

  \medskip

  From now on: Only require valuations of random clocks (projection)
  \begin{itemize}
    \item Used for integration
    \item Non-expired clocks require special handling (\enquote{lifting})
  \end{itemize}

  \bigskip

  \centering
  \input{pics/project_and_lift}

\end{frame}

%########################################################

\begin{frame}{Optimal paths}
  Depending on the scheduler type, valuations of random clocks are treated differently.

  \bigskip

  \begin{minipage}[t]{.6\linewidth}
    \only<1-2>{
    Non-prophetic scheduler
    \begin{itemize}
      \item Each non-determistic choice introduces new schedulers
      \item Enumerate all schedulers for all possible combinations of choices (traverse the reach tree)
      \item Collect random variable assignments for each scheduler
      \item Maximize/minimize: choose scheduler accordingly
    \end{itemize}
    }%
    \only<3>{
    Prophetic scheduler
    \begin{itemize}
      \item Can optimize decisions based on all past and future random variable assignments
      %\item Collect variable assignments for each possible branching (similar to non-prophetic)
      \item For each choice
      \begin{itemize}
        \item Maximizing: union over clock intervals (\enquote{consider all possible options}),

        {\scriptsize\cb{Here:} if $r_0$ expires before $b$, chose $B$, otherwise chose $A$}

        \item Minimizing: intersection of clock intervals (\enquote{only consider what cannot be avoided})

        {\scriptsize\cb{Here:} if $r_0$ expires before $b$, chose $A$, otherwise chose $B$}
      \end{itemize}

    \end{itemize}
    }%
    \only<4>{
    Prophetic scheduler
    \begin{itemize}
        \item Maximizing: union over clock intervals (\enquote{consider all possible options}),

        {\scriptsize Assuming $b > c$: $\mathit{goal}$ can always be reached}

        \item Minimizing: intersection of clock intervals (\enquote{only consider what cannot be avoided})

        {\scriptsize Assuming $b > c$: $\mathit{goal}$ can not be avoided if $r_0$ expires in $(c,b)$}

    \end{itemize}
    }%
  \end{minipage}%
  \begin{minipage}[t]{.4\linewidth}
    Example

    \centering

    \only<1>{\input{pics/schedulertree_choiceA}}%
    \only<2>{\input{pics/schedulertree_choiceB}}%
    \only<3>{\input{pics/schedulertree}}%
    \only<4>{\input{pics/schedulertree_prophetic}}%
  \end{minipage}%

\end{frame}

%########################################################

\begin{frame}{Case study}
  \begin{minipage}[t]{.6\linewidth}
    \begin{itemize}
      \item Constant inflow
      \item Non-deterministic choice of outflow-valve
      \item Chosen valves stay active for a fixed time
      \item After using a valve, it is blocked for a random amount of time
    \end{itemize}
  \end{minipage}%
  \begin{minipage}[t]{.4\linewidth}
    \centering
    Sketch


    \input{pics/case_study_sketch}
  \end{minipage}%

\end{frame}

%########################################################

\begin{frame}{Conclusion \& prospect}

\begin{itemize}
  \item Compute optimal probabilities for prophetic and non-prophetic schedulers
  \item No discretization required
  \item Similar complexity for both scheduler types
\end{itemize}

\bigskip

Prospect
\begin{itemize}
  \item Further types of non-determinism
  \begin{itemize}
    \item Non-deterministic rates (e.g., rectangular automata)
    \item Non-deterministic jump times
  \end{itemize}
  \item Other state set representations
\end{itemize}

\end{frame}

%########################################################

\end{document}
